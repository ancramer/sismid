---
title: "Improving Forecasting Models"
author: "Nowcasting and forecasting of infectious disease dynamics"
engine: knitr
format:
  revealjs:
    output: slides/improving-forecasting-models.html
    footer: "Improving Forecasting Models"
    slide-level: 3
---

### Which Model to Use?

There are *many* types of models available to us, (you've already seen a lot now):

-   A range of choices from mechanistic to purely statistical.

-   Bayesian, frequentist, machine learning.

-   Stochastic vs. Deterministic

How should we decide which model(s) to incorporate for nowcasting and forecasting? 

What outputs and features do we require of these models?


### Using Data the Data to Help Inform your Modeling Choices

Often, what motivates one's modeling choices is the *data* and *patterns* observed in the data.


```{r, echo=FALSE}
#![](figures/wili_timeseries.png){fig-align="center"}
library("nfidd")
library("fable")
library("dplyr")
library("tidyr")
library("ggplot2")
library("epidatr")
library("gridExtra")
data(flu_data)
flu_data <- flu_data |>
  filter(epiweek <= "2017-08-27") # Filter to start of 2017/2018 season
ggplot(flu_data) +
  geom_path(aes(x=epiweek, y=wili)) + 
  ggtitle("wILI to 2017/2018 Season")
```

### Seasonality

A seasonal pattern may suggest autocorrelation in the time series data.

```{r, echo = FALSE}
flu_data |> feasts::gg_season(wili, 
                              period = "year",
                              labels = "right",
                              labels_right_nudge = 5,
                              labels_repel = T) +
  ggtitle("Seasonality in ILI")
```

### Autocorrelation

Autocorrelation and Partial Autocorrelation (ACF/PACF) plots measure the linear 
relationship between *lagged values* of a time series. 

```{r}
feasts::gg_tsdisplay(flu_data, y = wili, plot_type='partial', lag_max = 104)
```

### Describing our Autocorrelations

- There are periodic correlations: 
  - strong positive correlations close time points and those ~52 weeks/ 1 year apart.
  - negative correlations peaking around ~6 months.
- The PACF estimates the correlation between values after adjusting for the effects of the previous lags.
  - There's a significant PACF at 1 week ahead and ~52 weeks/1 year.
- These plots suggest seasonality should be incorporated into our forecast models.

### Transformations and Adjustments

We often desire variance-stablizing transformations to make the variance more 
constant across different mean values. 

```{r, echo=FALSE}
p1 <- flu_data |>
  filter(epiweek >= "2005-10-01", epiweek <= "2010-06-01") |>
  ggplot(aes(x=epiweek, y=wili)) +
  geom_path() + 
  geom_point() + 
  ggtitle("Original Scale")

p2 <- flu_data |>
  filter(epiweek >= "2005-10-01", epiweek <= "2010-06-01") |>
  ggplot(aes(x=epiweek, y=wili)) +
  geom_path() + 
  geom_point() +
  scale_y_log10() + 
  ggtitle("Log 10 Scale")
  
p3 <- flu_data |>
  filter(epiweek >= "2005-10-01", epiweek <= "2010-06-01") |>
  mutate(fourth_root = wili**(1/4)) |>
  ggplot(aes(x=epiweek, y=fourth_root)) +
  geom_path() + 
  geom_point() + 
  ggtitle("Fourth Root Scale")

p4 <- flu_data |>
  filter(epiweek >= "2005-10-01", epiweek <= "2010-06-01") |>
  mutate(square_root = wili**(1/2)) |>
  ggplot(aes(x=epiweek, y=square_root)) +
  geom_path() + 
  geom_point() + 
  ggtitle("Square Root Scale")

# Arrange plots in a 2x2 grid
grid.arrange(p1, p2, p3, p4, nrow = 2, ncol = 2)
```

### Time-series Regression Models

For now, we'll focus on **time-series regression models**.

One widely applicable model type are the ARIMA models. ARIMA or autoregressive integrated moving average models capture patterns such as trends and autocorrelation:

- AR (Autoregressive): Uses past values to predict current ones.
- I (Integrated): Applies differencing to make the series stationary.
- MA (Moving Average): Uses recent forecast errors to refine predictions.


## `r fontawesome::fa("laptop-code", "white")` Your Turn {background-color="#447099" transition="fade-in"}

1.  Explore the influenza dataset some more focusing on assessing observed patterns qualitatively and quantitatively.
2.  Explore different ways of improving modeling forecasts by incorporating patterns observed in data into our models.

# 

[Return to the session](../improving-forecasting-models)

---
title: "Forecasting concepts"
order: 7
bibliography: ../nfidd.bib
---

# Introduction

Epidemiological forecasts are statements about what might happen to population disease burden in the future.
These statements sometimes will be a simple point estimate.
Other times, they might be probabilistic, meaning they are making an explicit statistical statement about the probabilities of different future outcomes.
In this session we will make some simple forecasts using a decades-old statistical modeling approach, Auto-Regressive Integrated Moving Average (ARIMA), which has also shown itself to be a very capable framework for making predictions of infectious diseases.
We will see how we can visualise and interpret such forecasts.

## Slides

-   [Introduction to forecasting](slides/introduction-to-forecasting)

## Objectives

The aim of this session is to introduce the concept of forecasting and forecast visualisation using a simple model.

:::: {.callout-note collapse="true"}
# Setup

## Source file

The source file of this session is located at `sessions/forecast-concepts.qmd`.

## Libraries used

In this session we will use the `fpp3` package to load models and methods from the [Forecasting Principles and Practice (v3) textbook](https://otexts.com/fpp3/) (including the `fable` package for simple forecasting models), the `dplyr` package for data wrangling, the `ggplot2` library for plotting and the `epidatr` package for accessing and downloading versions of epidemiological surveillance data from the [Delphi EpiData API](https://cmu-delphi.github.io/delphi-epidata/).

```{r libraries, message = FALSE}
library("fpp3")
library("dplyr")
library("ggplot2")
library("epidatr")
theme_set(theme_bw())
```

::: callout-tip
The best way to interact with the material is via the [Visual Editor](https://docs.posit.co/ide/user/ide/guide/documents/visual-editor.html) of RStudio.
:::

## Initialisation

We set a random seed for reproducibility.
Setting this ensures that you should get exactly the same results on your computer as we do.
This is not strictly necessary but will help us talk about the models.

```{r}
set.seed(17)
```
::::

# What is forecasting?

Forecasting is the process of making predictions about the future based on past and present data.
In the context of infectious disease epidemiology, forecasting is usually the process of predicting the future course of some metric of infectious disease incidence or prevalence based on data available at the present time.
In this session we focus on forecasting one particular outcome for influenza surveillance but forecasts can also be made for other quantities of interest such as the number of infections, the reproduction number, or the number of deaths.
Epidemiological forecasting is closely related to nowcasting and, when using mechanistic approaches, estimation of the reproduction number.

In previous sessions, the focus was on a setting where only limited data from a single outbreak was available.
Starting with this session, we will focus on a setting where you have multiple prior "seasons" of data to model.
This introduces new and different opportunities and complexities for modeling.

# Getting acquainted with ILI

Influenza-like illness (ILI) is a commonly used epidemiological surveillance measure for tracking the influenza season.
An individual is classified as having ILI if they have a fever AND an additional "flu-like" symptom, such as a cough, headache, sore throat, etc...
In the US, ILI data has been collected in a more or less consistent way for over 20 years at the national and state level.
These data, including versions available at specific times, are available through the [Delphi EpiData API](https://cmu-delphi.github.io/delphi-epidata/). Specifically, the ILI signal that is published by the CDC measures the percentage of all outpatient doctor's office visits due to ILI in a given epidemiological week.

The following code downloads ILI data for the USA for all weeks starting with the 2023/2024 season through the start of the 2027/2018 season.
Specifically, we use the weighted ILI variable (`wili`) which uses population-based weights estimate to try to generate a representative estimate of ILI for a specific population.
We filter to only include columns that we need and convert the resulting object into a `tsibble` which is [a special kind of time-series data frame](https://tsibble.tidyverts.org/).

```{r load_data}
flu_data <- epidatr::pub_fluview(regions = "nat", 
                                 epiweeks = epirange(200335, 201735)) |> 
  select(region, epiweek, wili) |> 
  as_tsibble(index = epiweek, key = region)
```

::: callout-tip
## What is an epiweek?

Measuring time is complicated.
Epiweeks are a common unit of time in epidemological surveillance data.
Also referred to as [MMWR weeks](https://ibis.doh.nm.gov/resource/MMWRWeekCalendar.html), an epiweek starts on a Sunday and ends on a Saturday.
Most years have 52 epiweeks.
Some have 53.
Week 1 of a specific year is the first week of the calendar year that has at least four days in it.
:::


## Look at the data

Here are the first 10 rows of the dataset.
```{r look-at-data}
flu_data
```

And here is a simple `ggplot`-style figure of the data.
```{r data-first-plot}
ggplot(flu_data) +
  geom_path(aes(x=epiweek, y=wili))
```

But note that one of the advantages of using `tsibbles` is that there are some default time-series plots that can be made:
```{r first-autoplot}
autoplot(flu_data, .vars = wili) +
  labs(title = "National-level ILI data from the US CDC",
       y = "weighted ILI (% of visits)")
```

## Take 5 minutes

Look at the plot of data carefully. Write down at least three observations about the data. Share notes with your neighbor. What features of this time-series make it easier or harder to predict?


# Fitting a simple forecasting model

To start with, we are going to use the [`fable` package](https://fable.tidyverts.org/) to build some simple forecasting models. There are lots of ways that you might want to consider building your own 

## References

::: {#refs}
:::
